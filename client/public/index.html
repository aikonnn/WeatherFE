<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#000000" />
		<meta
			name="description"
			content="Web site created using create-react-app"
		/>
		<link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
		<link
			href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css"
			rel="stylesheet"
		/>
		<script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
		<script src="/lib/azure-maps-animations.min.js"></script>

		<link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
		<title>React App</title>

		<script>
			var map, tileLayer;

			var weatherTileUrl =
				'https://{azMapsDomain}/map/tile?api-version=2.0&tilesetId={layerName}&zoom={z}&x={x}&y={y}';

			function GetMap() {
				//Initialize a map instance.
				map = new atlas.Map('myMap', {
					center: [-99.47, 40.75],
					zoom: 3,
					view: 'Auto',
					style: 'grayscale_dark',

					//Add authentication details for connecting to Azure Maps.
					authOptions: {
						// //Use Azure Active Directory authentication.
						// authType: 'anonymous',
						// clientId: 'e6b6ab59-eb5d-4d25-aa57-581135b927f0', //Your Azure Maps client id for accessing your Azure Maps account.
						// getToken: function(resolve, reject, map) {
						// 	//URL to your authentication service that retrieves an Azure Active Directory Token.
						// 	var tokenServiceUrl =
						// 		'https://samples.azuremaps.com/api/GetAzureMapsToken';

						// 	fetch(tokenServiceUrl)
						// 		.then(r => r.text())
						// 		.then(token => resolve(token));
						// }

						//Alternatively, use an Azure Maps key. Get an Azure Maps key at https://azure.com/maps. NOTE: The primary key should be used as the key.
						authType: 'subscriptionKey',
						subscriptionKey: 'VQ-LDi3o1UVkC0dlcfhrhsTQgvt24DQ7YhQau0vMnko'
					}
				});

				//Wait until the map resources are ready.
				map.events.add('ready', function() {
					//Create a style control and add it to the map.
					map.controls.add(
						new atlas.control.StyleControl({
							mapStyles: 'all'
						}),
						{
							position: 'top-right'
						}
					);

					//Initialize the weather tile layer.
					updateTileLayer();
				});
			}

			function updateTileLayer() {
				var layerName = document.getElementById('layerSelector').value;

				var tileUrl = weatherTileUrl.replace('{layerName}', layerName);

				if (!tileLayer) {
					//Create a tile layer and add it to the map below the label layer.
					tileLayer = new atlas.layer.TileLayer({
						tileUrl: tileUrl,
						opacity: 0.9,
						tileSize: 256
					});

					map.layers.add(tileLayer, 'labels');
				} else {
					tileLayer.setOptions({
						tileUrl: tileUrl
					});
				}
			}
		</script>
	</head>
	<body onload="GetMap()">
		<noscript>You need to enable JavaScript to run this app.</noscript>
		<div id="root"></div>

		<div
			id="myMap"
			style="position:relative;width:100%;min-width:290px;height:600px;"
		></div>

		<div
			style="position:absolute;top:10px;left:10px;padding:10px;background-color:white;border-radius:10px;"
		>
			Select weather overlay:
			<select id="layerSelector" onchange="updateTileLayer()">
				<option value="microsoft.weather.radar.main" selected="selected"
					>Radar</option
				>
				<option value="microsoft.weather.infrared.main">Infrared</option>
			</select>
		</div>
	</body>
</html>
